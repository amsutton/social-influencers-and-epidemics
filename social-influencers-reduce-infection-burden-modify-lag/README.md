# Social influencers reduce infection burden and modify epidemic lag in group-structured populations 

![](https://github.com/amsutton/social-influencers-and-epidemics/blob/main/social-influencers-reduce-infection-burden-modify-lag/socinf_coverimage.png)

This analysis is primarily built in the ```Julia``` programming language using ```Agents.jl``` to implement and run agent-based models. The visualization of the results is completed in ```R``` programming language using primarily ```ggplot2``` and other parts of the ```tidyverse```.

The code was written by Aja Sutton, with input from co-authors: Adam Z. Reynolds, Matthew A. Turner, and James Holland Jones.

Our SIR model is inspired by [Simon Frost (@sdwfrost)'s epirecipes: SIR for Julia using Agents.jl, 2020-04-27](https://github.com/epirecipes/sir-julia/blob/master/markdown/abm/abm.md).

Below, we briefly describe how to reproduce this analysis in Julia and in R.


## Technical Specifications


### Run the agent-based model simulations in ```Julia``` using ```Agents.jl```

The first part of this project's code base uses the [Julia Language](https://julialang.org/) and
[DrWatson](https://juliadynamics.github.io/DrWatson.jl/stable/)
to make a reproducible scientific project named

> social_influence_epi.

To (locally) reproduce this project, do the following:

0. Download this code base. Notice that raw data are typically not included in the
   git-history and may need to be downloaded independently.
1. Open a Julia console and do:
   ```
   julia> using Pkg
   julia> Pkg.add("DrWatson") # install globally, for using `quickactivate`
   julia> Pkg.activate("path/to/this/project")
   julia> Pkg.instantiate()
   ```

This will install all necessary packages for you to be able to run the scripts and
everything should work out of the box, including correctly finding local paths.

You may notice that most scripts start with the commands:
```julia
using DrWatson
@quickactivate "social_influence_epi"
```
which auto-activate the project and enable local path handling from DrWatson.

From there, we have set up the analysis to run on Stanford's Linux-based Sherlock cluster computing system. The code for running the simulations is found in ```./src/slurm```. If you wish to run trials locally, see: ```src/baseline_analysis_forlocal.sh```. You can also simply run the models individually, one run at a time by running the scripts in ```/src```, which contain the experiment and the baseline for comparison.

In the paper, Scenario 1 results are generated by ```baseline.jl```, and Scenarios 2 and 3 results are generated by ```model_bidirectional_twogroup_influence.jl```. To examine the actual parametrisations, and the models themselves, see: ```./code/models```. The two ```.jl``` scripts here are identical models, except that the ```baseline.jl``` model omits the effects of social influencers present in ```model_bidirectional_twogroup_influence.jl```, i.e., they are functionally the same model, where one has the influencer dynamic turned off. 

Two warnings: This part of the analysis produces large CSV files (10 files per homophily/out-group aversion parametrisation, with 100 runs in each to equal 1000 full runs -- this is specified in this way to ease computation with parallelisation). It is extremely computationally intense, and can take a long time! We ran sets of calls to the cluster to ease computational demand (it can take hours, or days, depending on how many you choose to run). With this in mind, we will share the data cleaned in ```R``` (described below) to facilitate the reproduction of the analyses and visualisation.

### Clean, analyze, and visualize the generated data in ```R```

The analyses and results in this paper can be reproduced by opening the ```R``` project file: ```social_influence.Rproj```. Assuming you have run the simulation code, you will have the data saved appropriately. If you are not running the ```Julia``` code, you must assure you have the cleaned objects in the ```/data``` folder (these are available at [LINK FORTHCOMING UPON PUBLICATION]). 

If you are cleaning the raw simulation data, run the code in the script: ```code/r_code/00a_run_from_source.R```. If you are processing previously cleaned code, open up ```00a_run_from_source.R``` and run the code, omitting line 18 (the processing script). 

This process should generate behaviour and infection curves, as well as analytical results, tables, and figures used in the paper.

Note: we have used a ```substring()``` call a few times in the analytical scripts; it may be necessary to change the indexing in these calls based on the full pathway string your computer uses. We have provided comments on what the extracted strings should look like to ease this process. We aim to replace these with relative pathways soon.

If you have questions or comments, please get in touch with Aja by email, which you can find [here](https://amsutton.github.io/).




